---
layout: post
title: 双向路径追踪
key: t20181113
tags:
  - Atrc
  - Graphics
---

本文讨论双向路径追踪算法的理论与实现。

<!--more-->

## LTE的路径和形式

首先祭出表面积形式的LTE（Light Transport Equation）：

$$
L(x \to \Theta) = L_e(x \to \Theta) + \int_{\mathcal M}f_s(e_{xx'} \to x \to \Theta)L(x' \to e_{x'x})G(x, x')V(x, x')dA^\perp_{x'}
$$

可以看到，从$x$出发面向$\Theta$方向的辐射亮度$L(x \to \Theta)$可以拆成两部分的和：

1. 自发光$L_e(x \to \Theta)$
2. 反射自其他方向的光

其中反射光本身又用到了$L$，于是我们可以用LTE继续拆分反射光内的那个$L$，反反复复无穷尽也。最后，我们得到了这样的方程组（记$x_0 = x, x_{-1} = x_0 + e_\Theta$）：

$$
\begin{aligned}
    &L(x_0 \to x_{-1}) = \\
    &\sum_{i = 0}^\infty\left(\idotsint_{\mathcal M^i}L_e(x_i \to x_{i-1})\left(\prod_{k=0}^i f_s(x_{k+1} \to x_k \to x_{k-1})G(x_{k+1}, x_k)V(x_{k+1}, x_k)\right)dA^\perp_{x_i}\cdots dA^\perp_{x_1}\right)
\end{aligned}
$$

它的含义是：$L(x \to \Theta)$可以拆成以下部分的和：

- 场景中的自发光经$0$次散射后朝向$\Theta$的辐射亮度（其实就是$x$点的自发光）
- 场景中的自发光经$1$次散射后朝向$\Theta$的辐射亮度
- 场景中的自发光经$2$次散射后朝向$\Theta$的辐射亮度
- ……
- 场景中的自发光经$n$次散射后朝向$\Theta$的辐射亮度

或者我们可以换用另一种表示方法，把所有的路径写到一起：

$$
L(x \to \Theta) = \int_{\text{path space}}w(p)d\mu_p
$$

因此，我们可以选取合适的概率密度函数来采样路径，然后使用蒙特卡洛方法估值即可。

（施工中……）
